<!--
 * @Author: your name
 * @Date: 2020-12-18 16:50:47
 * @LastEditTime: 2020-12-22 20:56:58
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \renai-back-stage-management\src\views\demo\page1\doc.md
-->
# 表示层和会话层


<br />众所周知：OSI参考模型是七层，TCP/IP模型是四层。但虽说TCP/IP由四层组成，各个资料对最下面一层的称呼也不尽相同（[参考](https://en.m.wikipedia.org/wiki/Internet_protocol_suite#Layer_names_and_number_of_layers_in_the_literature)）。在维基百科里被称为链路层（link layer，[维基百科](https://en.m.wikipedia.org/wiki/Internet_protocol_suite)），在百度百科里被称为网络接口层（network interface layer），而有的教材称之为主机到网络层（host-to-network layer）。<br />
<br />关于这个主机到网络层的称呼，我请教了我使用的教科书的编者，他说“host-to-network”来源于教材：<br />

```
		Andrew S. Tanenbaum. Computer Networks（Fourth Edition）
   《计算机网络（第四版）》英文版 作者：Andrew S.Tanenbaum & David J.Wetherall，机械工业出版社
```

<br />中的第43页"Figure 1-21 The TCP/IP reference model"。这本书应该是白黑蓝配色封面上有红色赛车的那本，不知为何这本书似乎在国内不是太有名，jd上都是个位数评价，作者安德鲁塔嫩鲍姆也是《现代操作系统》的作者。然而上面参考链接里有作者的另一种参考模型，是五层的。<br />
<br />[http://www.dspmuranchi.ac.in/pdf/Blog/TCP.pdf](http://www.dspmuranchi.ac.in/pdf/Blog/TCP.pdf)<br />
<br />
<br />至于为什么叫做主机到网络层，这和网络结构的层次有关。为了使网络体系结构中各层次成为极为独立的构建模块，不同的层次有自己的寻址方案，比如应用层的主机名、网络层的IP地址以及链路层的MAC（Media Access Control）地址，也称为物理地址。因为存在不同的层，所以两台主机需要通讯就需要在IP和MAC地址之间进行转换，对于因特网而言，这是**地址解析协议**（Address Resolution Protocol，ARP）的任务。<br />
<br />地址解析协议的任务就是根据IP地址去获取MAC地址（那根据MAC获取IP就是反向地址解析协议RARP，例如将打印机服务器等小型嵌入式设备接入到网络时就经常会用到，需要架设一台RARP服务器）。想要沟通的计算机发出一个ARP广播消息，所有在这个广播域（网络段）的主机都会接受到这个包并处理它。ARP包包含了目的主机的IP地址，当一个主机收到ARP包后，如果这个主机的IP地址和ARP请求的IP地址不一致，它将会丢弃此ARP请求；如果一致，此主机将会把发送主机的IP地址和MAC映射地址缓存，并使用自己的MAC地址进行回复。一旦主机获得目标MAC地址就可以使用二层链路协议与主机进行通信。重点就是，**这个MAC到IP的映射会保存到发送和接受主机的ARP缓存中**，下一次在进行通信直接引用缓存即可。<br />
<br />所以虽然从字面上看起来，host **to** network，to像是只是个单方面的行为。这也是最初让我误解的地方，因为在网络参考模型中，两台主机之间的层次通道的沟通行为是双向的，这样表示显然有点说不过去。原来是建立通信成功之后映射会保存到各自的缓存中,那么之后这两台主机就可以在一个局域网里直接通信。<br />
<br />
<br />虽然与OSI模型相关联的协议很少使用，但是模型本身是有效的。TCP/IP模型本身很少使用，但是其协议却被广泛使用。现在广泛使用并写进教科书的实际上是二者的混合模型：由应用层、传输层、网络层、数据链路层、物理层组成的一种新的因特网协议栈。实际上确实是因为原来的最下一层兼并了物理层和数据链路层。<br />
<br />物理层构建的是一条物理通道，而数据链路层构建的是真正用于数据传输的逻辑通道。物理链路是指在物理层设备（包括传输介质、物理接口、收发器等）和相应物理层通信规程作用下形成的物理链路，是永久存在且不可删除的（除非物理拆除）；逻辑链路则是通信双方在需要进行数据通信时，在数据链路层设备和相应通信规程作用下建立的逻辑链路，可以永久存在（如局域网中的以太网络），也可以不是永久存在的（如广域网中的链路）。在物理层上是比特流是一位一位进行传输的，不久传输效率低下，而且容易出现数据传输差错（如出现某些数据位丢失或错位，在物理层又没有相应的通信规程进行数据传输差错控制）。引入数据链路层之后，可以在其上构建差错检测和控制、流量控制等方法；网络层也不需要关心物理层具体采用了哪种传输介质和通信设备，直接与数据链路层进行交互。<br />
<br />数据链路层的一些功能：<br />

```
 1. 链路管理，帧同步
 2. 流量控制，差错控制
 3. 数据和控制信息分开
 4. 透明传输和寻址
```


在不同的网络体系结构下，网络层的IP协议提供的是尽力而为的服务，不能保证数据一定会发送到对端地址。因此，数据传送过程中出现数据丢失、顺序混乱等问题的可能性会大大增加。像这样没有可靠性传输要求的网络层中，可以由传输层负责提供**“正确传输数据的处理”**。TCP/IP中，网络层与传输层相互协作以确保数据包能够传送到世界各地，实现可靠传输。

OSI模型诞生于学术界，研发者们的想法是十分理想的。他们希望创造出一种通用的模型，而会话层和表示层的目标是：**让不同的应用程序共享“会话层（session layer）”、“表示层（presentation layer）”的软件代码**。表示层主要处理在两个通信系统中交换信息的表示方式（能够解释交换数据）。发送端将数据从“某个计算机特定的数据格式”转换为“网络通用的标准的数据格式”后再发送出去；接收端主机收到数据之后将这些网络标准模式的数据恢复为“该计算机特定的数据格式”，然后再进行相应的处理。不同机器采用的编码和表示方法不同，使用的数据结构也不同。为了使不同表示方法的数据和信息之间能够互相交换，表示层采用抽象的方法定义数据结构并采用标准的编码形式。能够提供包括编码转换、数据压缩、数据加解密（它们是自解释的）以及数据描述（这使得应用程序不必担心在各台计算机中表示/存储的内部格式不同的问题）等数据表示变换功能；会话层允许运行在不同主机上的各个进程之间进行会话，利用传输层提供端到端的服务，这种服务主要表现为会话（包括建立、管理及终止进程间的会话），为表示层实体或用户进程建立连接并在连接上有序地传输数据；并向表示层提供它的增值服务，包括数据交换的定界和同步功能，包含了建立检查点和恢复方案的方法。<br />
<br />那么就很清楚了，OSI参考模型为什么太过“理想”。说到底，研发者们希望将表示层和会话层高度抽象以至于能够从应用层独立出来，但是实际上这两层在实际应用上很难保持统一性。就数据压缩来说，对于任何形式的通信只有当信息的发送方和接受方使用相同的编码机制的时候压缩数据通信才能够工作。那么想象一下数据在发送者和接受者的层次模型中传递的情形，双方的表示层如何确定使用哪一种方式进行压缩和解压缩呢？而数据压缩的方式非常多，不同特点的数据有不同的压缩方式（编码方式），一般的分类有：<br />

```
 1. 即时压缩和非即时压缩；
 2. 数据压缩和文件压缩；
 3. 无损压缩和有损压缩。
```
**<br />还有数据的加解密，有单向加密、双向加密、对称加密和非对称加密等等。会话层允许不同机器上的用户之间进行会话关系，除了对数据进行传送之外，还会提供一些增强型服务。其中一个服务是**管理会话控制**，会话层允许信息进行双向传输或者任一时刻进行单项传输（类似于物理通道上的半双工），对于单项传输会话层会使用令牌管理来判断哪一方可以执行关键性操作；另一个服务是**同步**，在进行文件传输时会话层在数据中插入同步点（建立检查点），在因为各种原因导致通信失效后可以从检查点恢复通信，重传最后一个同步点以后的数据。<br />
<br />或许可以使用**封装**的方式对表示层和会话层进行处理，就像对其他层的处理一样：首部字段 + 有效载荷字段。对于表示层，使用首部字段来声明数据的压缩方式和加密方式等。那其实也不太行，就以加密来说，一段数据可能只使用一种加密方式，也可能是多种；也可能是一段数据不同的段都会使用不同的加密方式。这就导致表示层根本无法高度抽象成一个独立的层级。所以，**谈不上复用的层级作为协议的一部分自然是没有任何意义的**。<br />
<br />
<br />所以最后的结果是，表示层和会话层没有被抛弃，而是将它们在应用层实现。由应用程序开发者进行处理，如果开发者们判断一个服务很重要，那他们就应该在应用程序中自行构建该功能。而使用了 SSL安全套接字 / TLS安全传输层 的网络（https）模型是六层，SSL/TLS位于http所处的应用层之下、传输层之上。http和https使用的是完全不同的连接方式，默认端口也不一样，前者是80，后者是443。
